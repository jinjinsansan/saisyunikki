# さくらのサーバー設定ガイド

## ステップ1: さくらのサーバーでデータベース作成

### 1-1. さくらのサーバーコントロールパネルにログイン
- https://secure.sakura.ad.jp/rs/cp/ にアクセス
- ドメイン名とパスワードでログイン

### 1-2. データベースの作成
1. 左メニューから「データベース」→「データベース」をクリック
2. 「データベース新規作成」をクリック
3. 以下の情報を入力：
   - **データベース名**: `kanjo_diary` (任意の名前)
   - **文字コード**: `UTF-8`
4. 「作成する」をクリック

### 1-3. データベースユーザーの作成
1. 「データベースユーザー新規作成」をクリック
2. 以下の情報を入力：
   - **ユーザー名**: `kanjo_user` (任意の名前)
   - **パスワード**: 強力なパスワードを設定
3. 「作成する」をクリック

### 1-4. データベースとユーザーの関連付け
1. 作成したデータベースの「編集」をクリック
2. 「データベースユーザー」で作成したユーザーを選択
3. 「更新」をクリック

### 1-5. 接続情報の確認
作成後、以下の情報をメモしてください：
- **ホスト名**: `mysql○○○.db.sakura.ne.jp` (○○○は数字)
- **データベース名**: 作成したデータベース名
- **ユーザー名**: 作成したユーザー名
- **パスワード**: 設定したパスワード
- **ポート**: `3306` (デフォルト)

## ステップ2: 環境変数の設定

プロジェクトの `.env` ファイルに以下の情報を設定してください：

```env
# さくらのサーバー データベース設定
DB_HOST=mysql○○○.db.sakura.ne.jp
DB_USER=kanjo_user
DB_PASSWORD=your_password_here
DB_NAME=kanjo_diary
DB_PORT=3306

# API URL (開発時)
VITE_API_URL=http://localhost:3001
```

## ステップ3: 依存パッケージのインストール

```bash
npm install mysql2 dotenv express cors
```

## ステップ4: データベース接続テスト

```bash
node test-sakura-connection.js
```

## ステップ5: APIサーバーの起動

```bash
node api/sakura-diary.js
```

## ステップ6: フロントエンドでの設定

アプリでさくらのサーバーを使用するには、以下の手順で設定を変更します：

1. 日記ページでさくらのサーバー同期機能を有効化
2. ローカルデータとサーバーデータの同期
3. オフライン時の自動フォールバック

## トラブルシューティング

### 接続エラーが発生する場合
1. データベースの作成が完了しているか確認
2. ユーザー名・パスワードが正しいか確認
3. ホスト名が正しいか確認
4. さくらのサーバーでデータベースへのアクセス権限があるか確認

### よくあるエラー
- `ER_ACCESS_DENIED_ERROR`: ユーザー名またはパスワードが間違っている
- `ENOTFOUND`: ホスト名が間違っている
- `ER_BAD_DB_ERROR`: データベース名が間違っている

## 次のステップ

1. データベース作成完了後、接続テストを実行
2. APIサーバーを起動してヘルスチェック
3. フロントエンドアプリでさくらのサーバー連携を有効化